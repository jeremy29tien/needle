    next_entry = read.csv(filename)
    num_reads = c(nrow(next_entry))
    #ROPmapped_readcount <- rowSums(next_entry)
    #next_entry <- next_entry[c(1)]
    #pviral <- next_entry/ROPmapped_readcount
    next_entry <- cbind(sample, num_reads) # (, ROPmapped_readcount, pviral)
    if(as.numeric(substring(sample,6)) %% 2 == 0) {
      next_entry <- cbind(next_entry, c(num_reads-totalviralcount[counter-1,2]))
    }
    totalviralcount <- rbind(totalviralcount,next_entry)
  }
sample = "PIVUS003"
totalviralcount <- data.frame(Sample=character(), Viral_Read_Count=character(), Paired_Difference=character())
counter = as.integer(1)
  print(sample)
  filename = paste("/users/j29tien/needle/results/",sample,".needle/",sample,"_Aligned--07c_viral_output.virus.megahit.contigs.SV.csv", sep="")
    next_entry = read.csv(filename)
    num_reads = c(nrow(next_entry))
    #ROPmapped_readcount <- rowSums(next_entry)
    #next_entry <- next_entry[c(1)]
    #pviral <- next_entry/ROPmapped_readcount
    next_entry <- cbind(sample, num_reads) # (, ROPmapped_readcount, pviral)
    if(as.numeric(substring(sample,6)) %% 2 == 0) {
      next_entry <- cbind(next_entry, c(num_reads-totalviralcount[counter-1,2]))
    }
    totalviralcount <- rbind(totalviralcount,next_entry)
  }
    next_entry = read.csv(filename)
    num_reads = c(nrow(next_entry))
    #ROPmapped_readcount <- rowSums(next_entry)
    #next_entry <- next_entry[c(1)]
    #pviral <- next_entry/ROPmapped_readcount
    next_entry <- cbind(sample, num_reads) # (, ROPmapped_readcount, pviral)
    if(as.numeric(substring(sample,6)) %% 2 == 0) {
      next_entry <- cbind(next_entry, c(num_reads-totalviralcount[counter-1,2]))
    }
    totalviralcount <- rbind(totalviralcount,next_entry)
  sample=substring(sample, 6)
  sample=as.numeric(sample)
  sample=sample+1
  sample=sprintf("PIVUS%03d", sample)
  counter=counter+1
  print(sample)
  filename = paste("/users/j29tien/needle/results/",sample,".needle/",sample,"_Aligned--07c_viral_output.virus.megahit.contigs.SV.csv", sep="")
    next_entry = read.csv(filename)
    num_reads = c(nrow(next_entry))
    #ROPmapped_readcount <- rowSums(next_entry)
    #next_entry <- next_entry[c(1)]
    #pviral <- next_entry/ROPmapped_readcount
    next_entry <- cbind(sample, num_reads) # (, ROPmapped_readcount, pviral)
    if(as.numeric(substring(sample,6)) %% 2 == 0) {
      next_entry <- cbind(next_entry, c(num_reads-totalviralcount[counter-1,2]))
    }
    totalviralcount <- rbind(totalviralcount,next_entry)
totalviralcount
sample
next_entry
next_entry = read.csv(filename)
next_entry
num_reads = c(nrow(next_entry))
    next_entry <- cbind(sample, num_reads) # (, ROPmapped_readcount, pviral)
substring(sample,6)
as.numeric(substring(sample,6)
)
as.numeric(substring(sample,6)) %% 2 == 0
num_reads-totalviralcount[counter-1,2]
totalviralcount[counter-1,2]
totalviralcount[counter - 1,2]
as.numeric(totalviralcount[counter - 1,2])
totalviralcount[counter - 1,2]
totalviralcount[[counter - 1,2]]
num_reads-totalviralcount[[counter-1,2]]
as.numeric(totalviralcount[[counter - 1,2]])
totalviralcount[[counter - 1,2]]
as.numeric(totalviralcount[[counter - 1,2]])
as.numeric(totalviralcount$num_reads[[counter - 1,2]])
as.numeric(totalviralcount$num_reads[[counter - 1]])
totalviralcount$num_reads[[counter - 1]]
as.int(totalviralcount$num_reads[[counter - 1]])
num_reads-totalviralcount$num_reads[[counter-1]]
as.numeric(as.character(totalviralcount$num_reads[[counter - 1]]))
num_reads - as.numeric(as.character(totalviralcount$num_reads[[counter - 1]]))
num_reads
next_entry
if(as.numeric(substring(sample,6)) %% 2 == 0) {
      next_entry <- cbind(next_entry, c(num_reads - as.numeric(as.character(totalviralcount$num_reads[[counter - 1]]))))
    }
    totalviralcount <- rbind(totalviralcount,next_entry)
next_entry
sample = "PIVUS003"
totalviralcount <- data.frame(Sample=character(), Viral_Read_Count=character(), Paired_Difference=character())
counter = as.integer(1)
  print(sample)
  filename = paste("/users/j29tien/needle/results/",sample,".needle/",sample,"_Aligned--07c_viral_output.virus.megahit.contigs.SV.csv", sep="")
    next_entry = read.csv(filename)
    num_reads = c(nrow(next_entry))
    #ROPmapped_readcount <- rowSums(next_entry)
    #next_entry <- next_entry[c(1)]
    #pviral <- next_entry/ROPmapped_readcount
    next_entry <- cbind(sample, num_reads) # (, ROPmapped_readcount, pviral)
    if(as.numeric(substring(sample,6)) %% 2 == 0) {
      next_entry <- cbind(next_entry, c(num_reads - as.numeric(as.character(totalviralcount$num_reads[[counter - 1]]))))
    }
    else {
      next_entry <- cbind(next_entry, c())
    }
    totalviralcount <- rbind(totalviralcount,next_entry)
    next_entry = read.csv(filename)
    num_reads = c(nrow(next_entry))
    #ROPmapped_readcount <- rowSums(next_entry)
    #next_entry <- next_entry[c(1)]
    #pviral <- next_entry/ROPmapped_readcount
    next_entry <- cbind(sample, num_reads) # (, ROPmapped_readcount, pviral)
    if(as.numeric(substring(sample,6)) %% 2 == 0) {
      next_entry <- cbind(next_entry, c(num_reads - as.numeric(as.character(totalviralcount$num_reads[[counter - 1]]))))
    } else {
      next_entry <- cbind(next_entry, c())
    }
    totalviralcount <- rbind(totalviralcount,next_entry)
totalviralcount
totalviralcount <- data.frame(Sample=character(), Viral_Read_Count=character(), Paired_Difference=character())
    next_entry = read.csv(filename)
    num_reads = c(nrow(next_entry))
    #ROPmapped_readcount <- rowSums(next_entry)
    #next_entry <- next_entry[c(1)]
    #pviral <- next_entry/ROPmapped_readcount
    next_entry <- cbind(sample, num_reads) # (, ROPmapped_readcount, pviral)
    if(as.numeric(substring(sample,6)) %% 2 == 0) {
      next_entry <- cbind(next_entry, c(num_reads - as.numeric(as.character(totalviralcount$num_reads[[counter - 1]]))))
    } else {
      next_entry <- cbind(next_entry, c())
    }
    totalviralcount <- rbind(totalviralcount,next_entry)
totalviralcount
  sample=substring(sample, 6)
  sample=as.numeric(sample)
  sample=sample+1
  sample=sprintf("PIVUS%03d", sample)
  counter=counter+1
  print(sample)
  filename = paste("/users/j29tien/needle/results/",sample,".needle/",sample,"_Aligned--07c_viral_output.virus.megahit.contigs.SV.csv", sep="")
    next_entry = read.csv(filename)
    num_reads = c(nrow(next_entry))
    #ROPmapped_readcount <- rowSums(next_entry)
    #next_entry <- next_entry[c(1)]
    #pviral <- next_entry/ROPmapped_readcount
    next_entry <- cbind(sample, num_reads) # (, ROPmapped_readcount, pviral)
    if(as.numeric(substring(sample,6)) %% 2 == 0) {
      next_entry <- cbind(next_entry, c(num_reads - as.numeric(as.character(totalviralcount$num_reads[[counter - 1]]))))
    } else {
      next_entry <- cbind(next_entry, c())
    }
    totalviralcount <- rbind(totalviralcount,next_entry)
totalviralcount
q()
q()
startSample = "PIVUS003"
endSample = "PIVUS018"
sample=startSample
#totalviralcount <- read.csv(paste("/users/j29tien/ROP/results/",sample,"_ROP/",sample,"_Aligned--counts.csv", sep=""))
#ROPmapped_readcount <- rowSums(totalviralcount)
#totalviralcount <- totalviralcount[c(1)]
#will be making this a proportion of all the reads ROP was able to map
#pviral <- totalviralcount/ROPmapped_readcount
#totalviralcount <- cbind(sample,totalviralcount, ROPmapped_readcount, pviral)
totalviralcount <- data.frame(Sample=character(), Viral_Read_Count=character(), Paired_Difference=character())
counter = as.integer(1)
repeat {  # loop includes endSample                               
  print(sample)
  filename = paste("/users/j29tien/needle/results/",sample,".needle/",sample,"_Aligned--07c_viral_output.virus.megahit.contigs.SV.csv", sep="")
  if(file.exists(filename)) {
    next_entry = read.csv(filename)
    num_reads = c(nrow(next_entry))
    #ROPmapped_readcount <- rowSums(next_entry)
    #next_entry <- next_entry[c(1)]
    #pviral <- next_entry/ROPmapped_readcount
    next_entry <- cbind(sample, num_reads) # (, ROPmapped_readcount, pviral)
    if(as.numeric(substring(sample,6)) %% 2 == 0) {
      next_entry <- cbind(next_entry, c(num_reads - as.numeric(as.character(totalviralcount$num_reads[[counter - 1]]))))
    } else {
      next_entry <- cbind(next_entry, c(""))
    }
    totalviralcount <- rbind(totalviralcount,next_entry)
  }
  if(sample == endSample) {
    break
  }
  sample=substring(sample, 6)
  sample=as.numeric(sample)
  sample=sample+1
  sample=sprintf("PIVUS%03d", sample)
  counter=counter+1
}
totalviralcount
next_entry
counter
sample
as.numeric(substring(sample,6)) %% 2 == 0 
(as.character(totalviralcount$num_reads[[counter - 1]]))
(as.character(totalviralcount$num_reads[[counter - 1]]))
totalviralcount$num_reads[[counter - 1]]
q()
in_file = "/users/j29tien/needle/results/VIRAL/sample-counts.csv"
data=read.csv(in_file)
data
data[,(c(1,2,3)]
data[,c(1,2,3)]
data[,c(1,2,3,4)]
data[,c(1,2,3data=read.csv(in_file)[,c(1,2,3)])]
data=read.csv(in_file)[,c(1,2,3)]
data
data=read.csv(in_file)[,c(4)]
data
data=read.csv(in_file)[,c(1,2,3)]
data
ata<-data[!(data$sample =="PIVUS039"),] # doesn't have PIVUS040 (80 yr old) pair
data <- cbind(data, Age=factor(rep(c("Age 70","Age 80"),64)))
in_file = "/users/j29tien/needle/results/VIRAL/sample-counts.csv"
data=read.csv(in_file)[,c(1,2,3)]
data<-data[!(data$sample =="PIVUS039"),] # doesn't have PIVUS040 (80 yr old) pair
data <- cbind(data, Age=factor(rep(c("Age 70","Age 80"),64)))
data
:wq
data=read.csv(in_file)[,c(4)]
data
data.factor()
data.colname()
data.colnames()
data.colnames
colnames(data)
colnames(data)<-"diff"
sum(data)
sum(data,na.rm=TRUE)
data=read.csv(in_file)[,c(4)]
data <- data[!is.na(data)]
data
## Make boxplot and run t-test for paired data (differences)
data=read.csv(in_file)[,c(4)]
data <- data[!is.na(data)]
p=ggplot(data = data  %>% mutate(outlier=ifelse(is_outlier(data), yes = as.character(sample),no = "")), mapping = aes(x = "Age 80 - Age 70", y = data)) + geom_boxplot
() + geom_text_repel(mapping = aes(label=outlier), size=5) + scale_fill_manual(values = c("darkred", "darkblue")) + ylab("Viral Reads\n (count
s)") + theme_bw() + theme(axis.title.x = element_blank(), axis.text.x = element_text(color="black", size = 17), axis.title.y = element_text(size=20),  axis.text.y = e
lement_text(size=12), legend.position = "none") + annotate(geom = "text", x = 1.5, y = 4, label=paste0("p-value=",format(x = pvalue, digits = 2, scientific = T)), siz
e=5)
print(p)
q()
data
data.values
as.numeric(data)
as.character(data)
as.numeric(as.character(data))
q()
data=read.csv(in_file)[,c(4)]
data
data=read.csv(in_file)[,c(1,4)]
data
data=read.csv(in_file)[,c(2,4)]
data
data <- data[!is.na(data)]
data
q()
data=read.csv(in_file)[,c(1,2,3)]
data<-data[!(data$sample =="PIVUS039"),] # doesn't have PIVUS040 (80 yr old) pair
data <- cbind(data, Age=factor(rep(c("Age 70","Age 80"),64)))
data
data %>% group_by(Age)
data %>% group_by(Age)  %>% mutate(outlier=ifelse(is_outlier(num_reads)
,
q()
sample = "PIVUS003"
sample_virus_table <- data.frame(Sample=character())
sample_virus_table
  print(sample)
  filename = paste("/users/j29tien/needle/results/",sample,".needle/",sample,"_Aligned--07c_viral_output.virus.megahit.contigs.SV.csv", sep="")
filename
    next_entry = read.csv(filename)
    num_reads = c(nrow(next_entry))
next_entry
next_entry$name
next_entry$name[1]
next_entry$name[num_reads]
colnames(next_entry)
colnames(sample_virus_table)
"Sample" %in% colnames(sample_virus_table)
next_entry$name[1] %in% colnames(sample_virus_table)
test_df <- data.frame(Sample=character())
test_df
cbind(test_df, "virus name")
test_df$Hepatitis_C_virus_protease_ = 0
colnames(test_df) <- c(colnames(test_df), "Hepatitis_C_virus_protease_")
testdf$Hepatitis_C_virus_protease_ <- NA
test_df$Hepatitis_C_virus_protease_ <- NA
test_df
test_df[1][1]
test_df
rbind(test_df, "PIVUS003")
test_df <- rbind(test_df, "PIVUS003")
test_df
test_df$Hepatitis_C_virus_protease_ <- 0
test_df
sample_virus_table <- data.frame(Sample=character())
  print(sample)
  filename = paste("/users/j29tien/needle/results/",sample,".needle/",sample,"_Aligned--07c_viral_output.virus.megahit.contigs.SV.csv", sep="")
    next_entry = read.csv(filename)
    num_reads = c(nrow(next_entry))
    sample_virus_table <- rbind(sample_virus_table, sample)
sample_virus_table
        virus_name = next_entry$name[i]
    for (i in 1:num_reads){
        virus_name = next_entry$name[i]
        if(virus_name %in% colnames(sample_virus_table)) {
i = 1
        virus_name = next_entry$name[i]
          sample_virus_table$virus_name <- 1
sample_virus_table
          sample_virus_table${virus_name} <- 1
          sample_virus_table{$virus_name} <- 1
          sample_virus_table$(virus_name) <- 1
test_df["new col"] <- "a"
test_df
          sample_virus_table[virus_name] <- 1
virus_name
as.character(viral_name)
as.character(virus_name))
as.character(virus_name)
          sample_virus_table[as.character(virus_name)] <- 1
sample_virus_table
sample_virus_table <- data.frame(Sample=character())
  print(sample)
  filename = paste("/users/j29tien/needle/results/",sample,".needle/",sample,"_Aligned--07c_viral_output.virus.megahit.contigs.SV.csv", sep="")
    next_entry = read.csv(filename)
    num_reads = c(nrow(next_entry))
    sample_virus_table <- rbind(sample_virus_table, sample)
sample_V
sample_virus_table
i = 1
          sample_virus_table[as.character(virus_name)] <- 1
sample_virus_table
i = 2
        virus_name = next_entry$name[i]
          sample_virus_table[as.character(virus_name)] <- 1
sample_virus_table
sample_virus_table[1][Hepatitis_C_virus_protease_]
sample_virus_table[1]["Hepatitis_C_virus_protease_"]
colnames(sample_virus_table
)
sample_virus_table[1]["Hepatitis_C_virus_protease_"]
sample_virus_table["Hepatitis_C_virus_protease_"]
sample_virus_table["Hepatitis_C_virus_protease_"][1]
sample_virus_table["Hepatitis_C_virus_protease_"][2]
sample_virus_table["Sequence_17_from_Patent_WO2006110762_"][2]
sample_virus_table["Sequence_17_from_Patent_WO2006110762_"][1]
sample_virus_table["Sequence_17_from_Patent_WO2006110762_"][1] <- sample_virus_table["Sequence_17_from_Patent_WO2006110762_"][1] + 1
sample_virus_table["Sequence_17_from_Patent_WO2006110762_"][1]
sample_virus_table <- data.frame(Sample=character())
row_counter = 1
  print(sample)
  filename = paste("/users/j29tien/needle/results/",sample,".needle/",sample,"_Aligned--07c_viral_output.virus.megahit.contigs.SV.csv", sep="")
    next_entry = read.csv(filename)
    num_reads = c(nrow(next_entry))
    
    
    sample_virus_table <- rbind(sample_virus_table, sample)
i = 1
        virus_name = next_entry$name[i]
          sample_virus_table[as.character(virus_name)] <- 1
sample_virus_table
virus_name
          sample_virus_table[as.character(virus_name)][row_counter] <- sample_virus_table[virus_name][row_counter] + 1
row_counter
as.character(virus_name)
sample_virus_table[ "Hepatitis_C_virus_protease_"][1]
          sample_virus_table[as.character(virus_name)][row_counter] <- sample_virus_table[as.character(virus_name)][row_counter] + 1
sample_virus_table
          sample_virus_table[as.character(virus_name)][row_counter] <- sample_virus_table[as.character(virus_name)][row_counter] + 1
sample_virus_table
sample_virus_table <- data.frame(Sample=character())
row_counter = 1
  print(sample)
  filename = paste("/users/j29tien/needle/results/",sample,".needle/",sample,"_Aligned--07c_viral_output.virus.megahit.contigs.SV.csv", sep="")
    next_entry = read.csv(filename)
    num_reads = c(nrow(next_entry))
    sample_virus_table <- rbind(sample_virus_table, sample)
    for (i in 1:num_reads){
        virus_name = next_entry$name[i]
        if(virus_name %in% colnames(sample_virus_table)) {
          sample_virus_table[as.character(virus_name)][row_counter] <- sample_virus_table[as.character(virus_name)][row_counter] + 1
        } else {
          sample_virus_table[as.character(virus_name)] <- 1
        }
    }
sample_virus_table
write.csv(sample_virus_table, file="/users/j29tien/needle/results/VIRAL/sample-virus-table.csv")
    row_counter = row_counter+1
  sample=substring(sample, 6)
  sample=as.numeric(sample)
  sample=sample+1
  sample=sprintf("PIVUS%03d", sample)
  print(sample)
  filename = paste("/users/j29tien/needle/results/",sample,".needle/",sample,"_Aligned--07c_viral_output.virus.megahit.contigs.SV.csv", sep="")
    next_entry = read.csv(filename)
    num_reads = c(nrow(next_entry))
    sample_virus_table <- rbind(sample_virus_table, sample)
sample_virus_table
sample_virus_table <- data.frame(Sample=character())
row_counter = 1
sample = "PIVUS003"
  print(sample)
  filename = paste("/users/j29tien/needle/results/",sample,".needle/",sample,"_Aligned--07c_viral_output.virus.megahit.contigs.SV.csv", sep="")
    next_entry = read.csv(filename)
    num_reads = c(nrow(next_entry))
sample_virus_table <- rbind(sample_virus_table, NA)
sample_virus_table
rownames(sample_virus_table)
rownames(sample_virus_table) <- c(rownames(sample_virus_table), "PIVUS003")
rownames(sample_virus_table) <- c(rownames(sample_virus_table)
)
sample_virus_table
q()
sample
sample_virus_table <- data.frame(Sample=character())
row_counter = 1
  print(sample)
  filename = paste("/users/j29tien/needle/results/",sample,".needle/",sample,"_Aligned--07c_viral_output.virus.megahit.contigs.SV.csv", sep="")
    next_entry = read.csv(filename)
    num_reads = c(nrow(next_entry))
    sample_virus_table <- rbind(sample_virus_table, sample)
    for (i in 1:num_reads){
        virus_name = next_entry$name[i]
        if(virus_name %in% colnames(sample_virus_table)) {
          sample_virus_table[as.character(virus_name)][row_counter] <- sample_virus_table[as.character(virus_name)][row_counter] + 1
        } else {
          sample_virus_table[as.character(virus_name)] <- 1
        }
    }
    row_counter = row_counter+1
  sample=substring(sample, 6)
  sample=as.numeric(sample)
  sample=sample+1
  sample=sprintf("PIVUS%03d", sample)
  print(sample)
  filename = paste("/users/j29tien/needle/results/",sample,".needle/",sample,"_Aligned--07c_viral_output.virus.megahit.contigs.SV.csv", sep="")
    next_entry = read.csv(filename)
    num_reads = c(nrow(next_entry))
    sample_virus_table <- rbind(sample_virus_table, sample)
i = 1
        virus_name = next_entry$name[i]
virus_name
        if(virus_name %in% colnames(sample_virus_table)) {
          sample_virus_table[as.character(virus_name)][row_counter] <- sample_virus_table[as.character(virus_name)][row_counter] + 1
        } else {
          sample_virus_table[as.character(virus_name)] <- 1
        }
virus_name %in% colnames(sample_virus_table)
sample_virus_table[as.character(virus_name)][row_counter]
as.character(virus_name)
row_counter
sample_virus_table["Sequence_17_from_Patent_WO2006110762_"]
sample_virus_table["Sequence_17_from_Patent_WO2006110762_"][2]
sample_virus_table["Sequence_17_from_Patent_WO2006110762_"][1]
sample_virus_table["Sequence_17_from_Patent_WO2006110762_"][2]
sample_virus_table["Sequence_17_from_Patent_WO2006110762_"]
sample_virus_table["Sequence_17_from_Patent_WO2006110762_"][[1]]
sample_virus_table[2, "Sequence_17_from_Patent_WO2006110762_"]
sample_virus_table[1, "Sequence_17_from_Patent_WO2006110762_"]
sample_virus_table
          sample_virus_table[row_counter, as.character(virus_name)] <- sample_virus_table[row_counter, as.character(virus_name)] + 1
          sample_virus_table[[row_counter, as.character(virus_name)]] <- sample_virus_table[[row_counter, as.character(virus_name)]] + 1
sample_virus_table[[row_counter, as.character(virus_name)]]
sample = "PIVUS003"
sample_virus_table <- data.frame(Sample=character())
row_counter = 1
  print(sample)
  filename = paste("/users/j29tien/needle/results/",sample,".needle/",sample,"_Aligned--07c_viral_output.virus.megahit.contigs.SV.csv", sep="")
    next_entry = read.csv(filename)
    num_reads = c(nrow(next_entry))
    sample_virus_table <- rbind(sample_virus_table, 0)
    for (i in 1:num_reads){
        virus_name = next_entry$name[i]
        if(virus_name %in% colnames(sample_virus_table)) {
          sample_virus_table[[row_counter, as.character(virus_name)]] <- sample_virus_table[[row_counter, as.character(virus_name)]] + 1
        } else {
          sample_virus_table[row_counter, as.character(virus_name)] <- 1
        }
    }
    row_counter = row_counter+1
  sample=substring(sample, 6)
  sample=as.numeric(sample)
  sample=sample+1
  sample=sprintf("PIVUS%03d", sample)
sample_virus_table
  print(sample)
  filename = paste("/users/j29tien/needle/results/",sample,".needle/",sample,"_Aligned--07c_viral_output.virus.megahit.contigs.SV.csv", sep="")
    next_entry = read.csv(filename)
    num_reads = c(nrow(next_entry))
    sample_virus_table <- rbind(sample_virus_table, 0)
    for (i in 1:num_reads){
        virus_name = next_entry$name[i]
        if(virus_name %in% colnames(sample_virus_table)) {
          sample_virus_table[[row_counter, as.character(virus_name)]] <- sample_virus_table[[row_counter, as.character(virus_name)]] + 1
        } else {
          sample_virus_table[row_counter, as.character(virus_name)] <- 1
        }
    }
    row_counter = row_counter+1
  sample=substring(sample, 6)
  sample=as.numeric(sample)
  sample=sample+1
  sample=sprintf("PIVUS%03d", sample)
sample_virus_table
write.csv(sample_virus_table, file="/users/j29tien/needle/results/VIRAL/sample-virus-table.csv")
q()
